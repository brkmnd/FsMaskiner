<!DOCTYPE html>
<html>
    <head></head>
    <body>
        <p id="out"></p>
        <script>
var printfn = function(){
    var outfield = document.getElementById("out");
    return function(str){
        outfield.innerHTML += str + "<br>";
        };
    }();
var Stack = function(){
    var stack = {};
    var len = 0;
    var pub = {};
    pub.push = function(v0){
        if(stack[len] !== undefined){
            stack[len].val = v0;
        }
        else {
            stack[len] = {val:v0};
            }
        len++;
        };
    pub.pop = function(){
        if(len > 0){
            len--;
            return stack[len].val;
            }
        return null;
        };
    pub.popN = function(n,f){
        var n0 = n;
        while(len > 0 && n0 > 0){
            f(this.pop());
            n0--;
            }
        };
    pub.peek = function(){
        if(len > 0){
            return stack[len - 1].val;
            }
        return null;
        };
    pub.foreach = function(f){
        var i = len - 1;
        while(i >= 0){
            f(stack[i].val);
            i--;
            }
        };
    pub.count = function(){
        return len;
        };
    return pub;
    };
var actionType = {
    shift:function(d){
        return {type:"shift",v:d};
        },
    reduce:function(d){
        return {type:"reduce",v:d};
        },
    accept:function(d){
        return {type:"accept",v:null};
        },
    error:function(msg){
        return {type:"error",v:msg};
        },
    none:function(){
        return {type:"none",v:null};
        },
    some:function(v){
        return {type:"some",v:v}
        }
    };
var isSome = function(m){
    return m.t === "some";
    };
var isNone = function(m){
    return m.t === "none";
    };
var _token = function(m,o){
    //m.tv = token val
    //m.t = some/none
    //m.v = value if some, else null
    if(o[m.tv] !== undefined){
        return o[m.tv](m.tv,m.v);
        }
    };

var new_int = function(v){
    return {ntype:"int",nval:v};
    };
var new_id = function(v){
    return {ntype:"id",nval:v};
    };
var new_args = function(){
    return {ntype:"args",nval:[]};
    };


var addToken2tree = function(tree,node){
    _token(node,{
        "int":function(tokenV,capV){ return tree.push(new_int(capV)); },
        "id":function(tokenV,capV){ return tree.push(new_id(capV)); }
    });
    return tree;
    };
var productions_fun = {
    //[0] __ -> Exp' 
    0:function(tree){
        return tree;
        },
    //[1] Exp' -> Exp 
    1:function(tree){
        return tree;
        },
    //[2] Exp -> Exp minus Exp 
    2:function(tree){
        return tree;
        },
    //[3] Exp -> Exp plus Exp 
    3:function(tree){
        return tree;
        },
    //[4] Exp -> Exp times Exp 
    4:function(tree){
        //let a = tree.pop().nval;
        //let b = tree.pop().nval;
        return tree;
        //return tree.push(new_int(a * b));
        },
    //[5] Exp -> Exp divide Exp 
    5:function(tree){
        return tree;
        },
    //[6] Exp -> Exp power Exp 
    6:function(tree){
        return tree;
        },
    //[7] Exp -> Call 
    7:function(tree){
        return tree;
        },
    //[8] Exp -> Atom 
    8:function(tree){
        return tree;
        },
    //[9] Exp -> minus Exp 
    9:function(tree){ return tree; },
    //[10] Call -> id lpar Args rpar
    10:function(tree){
        alert(tree.peek().nval)
        return tree;
        },
    //[11] Args -> Arg 
    11:function(tree){ return tree; },
    //[12] Args -> Arg comma Args 
    12:function(tree){ return tree; },
    //[13] Arg -> Atom 
    13:function(tree){ return tree; },
    //[14] Arg -> Call 
    14:function(tree){ return tree; },
    //[15] Arg -> 
    15:function(tree){ return tree; },
    //[16] Atom -> lparExp rpar
    16:function(tree){ return tree; },
    //[17] Atom -> float
    17:function(tree){ return tree; },
    //[18] Atom -> int
    18:function(tree){ return tree; }
};
var productions_str = {
    0:{prod:"__",rside:["Exp'"]},
    1:{prod:"Exp'",rside:["Exp"]},
    2:{prod:"Exp",rside:["Exp","minus","Exp"]},
    3:{prod:"Exp",rside:["Exp","plus","Exp"]},
    4:{prod:"Exp",rside:["Exp","times","Exp"]},
    5:{prod:"Exp",rside:["Exp","divide","Exp"]},
    6:{prod:"Exp",rside:["Exp","power","Exp"]},
    7:{prod:"Exp",rside:["Call"]},
    8:{prod:"Exp",rside:["Atom"]},
    9:{prod:"Exp",rside:["minus","Exp"]},
    10:{prod:"Call",rside:["id","lpar","Args","rpar"]},
    11:{prod:"Args",rside:["Arg"]},
    12:{prod:"Args",rside:["Arg","comma","Args"]},
    13:{prod:"Arg",rside:["Atom"]},
    14:{prod:"Arg",rside:["Call"]},
    15:{prod:"Arg",rside:[]},
    16:{prod:"Atom",rside:["lpar","Exp","rpar"]},
    17:{prod:"Atom",rside:["float"]},
    18:{prod:"Atom",rside:["int"]}
};
var actionTable = {
    0:{
        "comma":t.error('some msg'),
        "divide":t.error('some msg'),
        "float":t.shift(5),
        "id":t.shift(6),
        "int":t.shift(7),
        "lpar":t.shift(8),
        "minus":t.shift(9),
        "plus":t.error('some msg'),
        "power":t.error('some msg'),
        "rpar":t.error('some msg'),
        "times":t.error('some msg'),
        "$":t.error('some msg')
        },
    1:{
        "comma":t.error('some msg'),
        "divide":t.reduce(8),
        "float":t.error('some msg'),
        "id":t.error('some msg'),
        "int":t.error('some msg'),
        "lpar":t.error('some msg'),
        "minus":t.reduce(8),
        "plus":t.reduce(8),
        "power":t.reduce(8),
        "rpar":t.reduce(8),
        "times":t.reduce(8),
        "$":t.reduce(8)
        },
    2:{
        "comma":t.error('some msg'),
        "divide":t.reduce(7),
        "float":t.error('some msg'),
        "id":t.error('some msg'),
        "int":t.error('some msg'),
        "lpar":t.error('some msg'),
        "minus":t.reduce(7),
        "plus":t.reduce(7),
        "power":t.reduce(7),
        "rpar":t.reduce(7),
        "times":t.reduce(7),
        "$":t.reduce(7)
        },
    3:{
        "comma":t.error('some msg'),
        "divide":t.shift(10),
        "float":t.error('some msg'),
        "id":t.error('some msg'),
        "int":t.error('some msg'),
        "lpar":t.error('some msg'),
        "minus":t.shift(11),
        "plus":t.shift(12),
        "power":t.shift(13),
        "rpar":t.error('some msg'),
        "times":t.shift(14),
        "$":t.reduce(1)
        },
    4:{
        "comma":t.error('some msg'),
        "divide":t.error('some msg'),
        "float":t.error('some msg'),
        "id":t.error('some msg'),
        "int":t.error('some msg'),
        "lpar":t.error('some msg'),
        "minus":t.error('some msg'),
        "plus":t.error('some msg'),
        "power":t.error('some msg'),
        "rpar":t.error('some msg'),
        "times":t.error('some msg'),
        "$":t.accept()
        },
    5:{
        "comma":t.reduce(17),
        "divide":t.reduce(17),
        "float":t.error('some msg'),
        "id":t.error('some msg'),
        "int":t.error('some msg'),
        "lpar":t.error('some msg'),
        "minus":t.reduce(17),
        "plus":t.reduce(17),
        "power":t.reduce(17),
        "rpar":t.reduce(17),
        "times":t.reduce(17),
        "$":t.reduce(17)
        },
    6:{
        "comma":t.error('some msg'),
        "divide":t.error('some msg'),
        "float":t.error('some msg'),
        "id":t.error('some msg'),
        "int":t.error('some msg'),
        "lpar":t.shift(15),
        "minus":t.error('some msg'),
        "plus":t.error('some msg'),
        "power":t.error('some msg'),
        "rpar":t.error('some msg'),
        "times":t.error('some msg'),
        "$":t.error('some msg')
        },
    7:{
        "comma":t.reduce(18),
        "divide":t.reduce(18),
        "float":t.error('some msg'),
        "id":t.error('some msg'),
        "int":t.error('some msg'),
        "lpar":t.error('some msg'),
        "minus":t.reduce(18),
        "plus":t.reduce(18),
        "power":t.reduce(18),
        "rpar":t.reduce(18),
        "times":t.reduce(18),
        "$":t.reduce(18)
        },
    8:{
        "comma":t.error('some msg'),
        "divide":t.error('some msg'),
        "float":t.shift(5),
        "id":t.shift(6),
        "int":t.shift(7),
        "lpar":t.shift(8),
        "minus":t.shift(9),
        "plus":t.error('some msg'),
        "power":t.error('some msg'),
        "rpar":t.error('some msg'),
        "times":t.error('some msg'),
        "$":t.error('some msg')
        },
    9:{
        "comma":t.error('some msg'),
        "divide":t.error('some msg'),
        "float":t.shift(5),
        "id":t.shift(6),
        "int":t.shift(7),
        "lpar":t.shift(8),
        "minus":t.shift(9),
        "plus":t.error('some msg'),
        "power":t.error('some msg'),
        "rpar":t.error('some msg'),
        "times":t.error('some msg'),
        "$":t.error('some msg')
        },
    10:{
        "comma":t.error('some msg'),
        "divide":t.error('some msg'),
        "float":t.shift(5),
        "id":t.shift(6),
        "int":t.shift(7),
        "lpar":t.shift(8),
        "minus":t.shift(9),
        "plus":t.error('some msg'),
        "power":t.error('some msg'),
        "rpar":t.error('some msg'),
        "times":t.error('some msg'),
        "$":t.error('some msg')
        },
    11:{
        "comma":t.error('some msg'),
        "divide":t.error('some msg'),
        "float":t.shift(5),
        "id":t.shift(6),
        "int":t.shift(7),
        "lpar":t.shift(8),
        "minus":t.shift(9),
        "plus":t.error('some msg'),
        "power":t.error('some msg'),
        "rpar":t.error('some msg'),
        "times":t.error('some msg'),
        "$":t.error('some msg')
        },
    12:{
        "comma":t.error('some msg'),
        "divide":t.error('some msg'),
        "float":t.shift(5),
        "id":t.shift(6),
        "int":t.shift(7),
        "lpar":t.shift(8),
        "minus":t.shift(9),
        "plus":t.error('some msg'),
        "power":t.error('some msg'),
        "rpar":t.error('some msg'),
        "times":t.error('some msg'),
        "$":t.error('some msg')
        },
    13:{
        "comma":t.error('some msg'),
        "divide":t.error('some msg'),
        "float":t.shift(5),
        "id":t.shift(6),
        "int":t.shift(7),
        "lpar":t.shift(8),
        "minus":t.shift(9),
        "plus":t.error('some msg'),
        "power":t.error('some msg'),
        "rpar":t.error('some msg'),
        "times":t.error('some msg'),
        "$":t.error('some msg')
        },
    14:{
        "comma":t.error('some msg'),
        "divide":t.error('some msg'),
        "float":t.shift(5),
        "id":t.shift(6),
        "int":t.shift(7),
        "lpar":t.shift(8),
        "minus":t.shift(9),
        "plus":t.error('some msg'),
        "power":t.error('some msg'),
        "rpar":t.error('some msg'),
        "times":t.error('some msg'),
        "$":t.error('some msg')
        },
    15:{
        "comma":t.reduce(15),
        "divide":t.reduce(15),
        "float":t.shift(5),
        "id":t.shift(6),
        "int":t.shift(7),
        "lpar":t.shift(8),
        "minus":t.reduce(15),
        "plus":t.reduce(15),
        "power":t.reduce(15),
        "rpar":t.reduce(15),
        "times":t.reduce(15),
        "$":t.reduce(15)
        },
    16:{
        "comma":t.error('some msg'),
        "divide":t.shift(10),
        "float":t.error('some msg'),
        "id":t.error('some msg'),
        "int":t.error('some msg'),
        "lpar":t.error('some msg'),
        "minus":t.shift(11),
        "plus":t.shift(12),
        "power":t.shift(13),
        "rpar":t.shift(27),
        "times":t.shift(14),
        "$":t.error('some msg')
        },
    17:{
        "comma":t.error('some msg'),
        "divide":t.shift(10),
        "float":t.error('some msg'),
        "id":t.error('some msg'),
        "int":t.error('some msg'),
        "lpar":t.error('some msg'),
        "minus":t.reduce(9),
        "plus":t.reduce(9),
        "power":t.shift(13),
        "rpar":t.reduce(9),
        "times":t.shift(14),
        "$":t.reduce(9)
        },
    18:{
        "comma":t.error('some msg'),
        "divide":t.reduce(5),
        "float":t.error('some msg'),
        "id":t.error('some msg'),
        "int":t.error('some msg'),
        "lpar":t.error('some msg'),
        "minus":t.reduce(5),
        "plus":t.reduce(5),
        "power":t.shift(13),
        "rpar":t.reduce(5),
        "times":t.reduce(5),
        "$":t.reduce(5)
        },
    19:{
        "comma":t.error('some msg'),
        "divide":t.shift(10),
        "float":t.error('some msg'),
        "id":t.error('some msg'),
        "int":t.error('some msg'),
        "lpar":t.error('some msg'),
        "minus":t.reduce(2),
        "plus":t.reduce(2),
        "power":t.shift(13),
        "rpar":t.reduce(2),
        "times":t.shift(14),
        "$":t.reduce(2)
        },
    20:{
        "comma":t.error('some msg'),
        "divide":t.shift(10),
        "float":t.error('some msg'),
        "id":t.error('some msg'),
        "int":t.error('some msg'),
        "lpar":t.error('some msg'),
        "minus":t.reduce(3),
        "plus":t.reduce(3),
        "power":t.shift(13),
        "rpar":t.reduce(3),
        "times":t.shift(14),
        "$":t.reduce(3)
        },
    21:{
        "comma":t.error('some msg'),
        "divide":t.reduce(6),
        "float":t.error('some msg'),
        "id":t.error('some msg'),
        "int":t.error('some msg'),
        "lpar":t.error('some msg'),
        "minus":t.reduce(6),
        "plus":t.reduce(6),
        "power":t.shift(13),
        "rpar":t.reduce(6),
        "times":t.reduce(6),
        "$":t.reduce(6)
        },
    22:{
        "comma":t.error('some msg'),
        "divide":t.reduce(4),
        "float":t.error('some msg'),
        "id":t.error('some msg'),
        "int":t.error('some msg'),
        "lpar":t.error('some msg'),
        "minus":t.reduce(4),
        "plus":t.reduce(4),
        "power":t.shift(13),
        "rpar":t.reduce(4),
        "times":t.reduce(4),
        "$":t.reduce(4)
        },
    23:{
        "comma":t.shift(28),
        "divide":t.error('some msg'),
        "float":t.error('some msg'),
        "id":t.error('some msg'),
        "int":t.error('some msg'),
        "lpar":t.error('some msg'),
        "minus":t.error('some msg'),
        "plus":t.error('some msg'),
        "power":t.error('some msg'),
        "rpar":t.reduce(11),
        "times":t.error('some msg'),
        "$":t.error('some msg')
        },
    24:{
        "comma":t.error('some msg'),
        "divide":t.error('some msg'),
        "float":t.error('some msg'),
        "id":t.error('some msg'),
        "int":t.error('some msg'),
        "lpar":t.error('some msg'),
        "minus":t.error('some msg'),
        "plus":t.error('some msg'),
        "power":t.error('some msg'),
        "rpar":t.shift(29),
        "times":t.error('some msg'),
        "$":t.error('some msg')
        },
    25:{
        "comma":t.reduce(13),
        "divide":t.reduce(13),
        "float":t.error('some msg'),
        "id":t.error('some msg'),
        "int":t.error('some msg'),
        "lpar":t.error('some msg'),
        "minus":t.reduce(13),
        "plus":t.reduce(13),
        "power":t.reduce(13),
        "rpar":t.reduce(13),
        "times":t.reduce(13),
        "$":t.reduce(13)
        },
    26:{
        "comma":t.reduce(14),
        "divide":t.reduce(14),
        "float":t.error('some msg'),
        "id":t.error('some msg'),
        "int":t.error('some msg'),
        "lpar":t.error('some msg'),
        "minus":t.reduce(14),
        "plus":t.reduce(14),
        "power":t.reduce(14),
        "rpar":t.reduce(14),
        "times":t.reduce(14),
        "$":t.reduce(14)
        },
    27:{
        "comma":t.reduce(16),
        "divide":t.reduce(16),
        "float":t.error('some msg'),
        "id":t.error('some msg'),
        "int":t.error('some msg'),
        "lpar":t.error('some msg'),
        "minus":t.reduce(16),
        "plus":t.reduce(16),
        "power":t.reduce(16),
        "rpar":t.reduce(16),
        "times":t.reduce(16),
        "$":t.reduce(16)
        },
    28:{
        "comma":t.reduce(15),
        "divide":t.reduce(15),
        "float":t.shift(5),
        "id":t.shift(6),
        "int":t.shift(7),
        "lpar":t.shift(8),
        "minus":t.reduce(15),
        "plus":t.reduce(15),
        "power":t.reduce(15),
        "rpar":t.reduce(15),
        "times":t.reduce(15),
        "$":t.reduce(15)
        },
    29:{
        "comma":t.reduce(10),
        "divide":t.reduce(10),
        "float":t.error('some msg'),
        "id":t.error('some msg'),
        "int":t.error('some msg'),
        "lpar":t.error('some msg'),
        "minus":t.reduce(10),
        "plus":t.reduce(10),
        "power":t.reduce(10),
        "rpar":t.reduce(10),
        "times":t.reduce(10),
        "$":t.reduce(10)
        },
    30:{
        "comma":t.error('some msg'),
        "divide":t.error('some msg'),
        "float":t.error('some msg'),
        "id":t.error('some msg'),
        "int":t.error('some msg'),
        "lpar":t.error('some msg'),
        "minus":t.error('some msg'),
        "plus":t.error('some msg'),
        "power":t.error('some msg'),
        "rpar":t.reduce(12),
        "times":t.error('some msg'),
        "$":t.error('some msg')
        }
    };
var gotoTable = {
    0:{
        "Arg":t.none(),
        "Args":t.none(),
        "Atom":t.some(1),
        "Call":t.some(2),
        "Exp":t.some(3),
        "Exp'":t.some(4)
        },
    1:{
        "Arg":t.none(),
        "Args":t.none(),
        "Atom":t.none(),
        "Call":t.none(),
        "Exp":t.none(),
        "Exp'":t.none()
        },
    2:{
        "Arg":t.none(),
        "Args":t.none(),
        "Atom":t.none(),
        "Call":t.none(),
        "Exp":t.none(),
        "Exp'":t.none()
        },
    3:{
        "Arg":t.none(),
        "Args":t.none(),
        "Atom":t.none(),
        "Call":t.none(),
        "Exp":t.none(),
        "Exp'":t.none()
        },
    4:{
        "Arg":t.none(),
        "Args":t.none(),
        "Atom":t.none(),
        "Call":t.none(),
        "Exp":t.none(),
        "Exp'":t.none()
        },
    5:{
        "Arg":t.none(),
        "Args":t.none(),
        "Atom":t.none(),
        "Call":t.none(),
        "Exp":t.none(),
        "Exp'":t.none()
        },
    6:{
        "Arg":t.none(),
        "Args":t.none(),
        "Atom":t.none(),
        "Call":t.none(),
        "Exp":t.none(),
        "Exp'":t.none()
        },
    7:{
        "Arg":t.none(),
        "Args":t.none(),
        "Atom":t.none(),
        "Call":t.none(),
        "Exp":t.none(),
        "Exp'":t.none()
        },
    8:{
        "Arg":t.none(),
        "Args":t.none(),
        "Atom":t.some(1),
        "Call":t.some(2),
        "Exp":t.some(16),
        "Exp'":t.none()
        },
    9:{
        "Arg":t.none(),
        "Args":t.none(),
        "Atom":t.some(1),
        "Call":t.some(2),
        "Exp":t.some(17),
        "Exp'":t.none()
        },
    10:{
        "Arg":t.none(),
        "Args":t.none(),
        "Atom":t.some(1),
        "Call":t.some(2),
        "Exp":t.some(18),
        "Exp'":t.none()
        },
    11:{
        "Arg":t.none(),
        "Args":t.none(),
        "Atom":t.some(1),
        "Call":t.some(2),
        "Exp":t.some(19),
        "Exp'":t.none()
        },
    12:{
        "Arg":t.none(),
        "Args":t.none(),
        "Atom":t.some(1),
        "Call":t.some(2),
        "Exp":t.some(20),
        "Exp'":t.none()
        },
    13:{
        "Arg":t.none(),
        "Args":t.none(),
        "Atom":t.some(1),
        "Call":t.some(2),
        "Exp":t.some(21),
        "Exp'":t.none()
        },
    14:{
        "Arg":t.none(),
        "Args":t.none(),
        "Atom":t.some(1),
        "Call":t.some(2),
        "Exp":t.some(22),
        "Exp'":t.none()
        },
    15:{
        "Arg":t.some(23),
        "Args":t.some(24),
        "Atom":t.some(25),
        "Call":t.some(26),
        "Exp":t.none(),
        "Exp'":t.none()
        },
    16:{
        "Arg":t.none(),
        "Args":t.none(),
        "Atom":t.none(),
        "Call":t.none(),
        "Exp":t.none(),
        "Exp'":t.none()
        },
    17:{
        "Arg":t.none(),
        "Args":t.none(),
        "Atom":t.none(),
        "Call":t.none(),
        "Exp":t.none(),
        "Exp'":t.none()
        },
    18:{
        "Arg":t.none(),
        "Args":t.none(),
        "Atom":t.none(),
        "Call":t.none(),
        "Exp":t.none(),
        "Exp'":t.none()
        },
    19:{
        "Arg":t.none(),
        "Args":t.none(),
        "Atom":t.none(),
        "Call":t.none(),
        "Exp":t.none(),
        "Exp'":t.none()
        },
    20:{
        "Arg":t.none(),
        "Args":t.none(),
        "Atom":t.none(),
        "Call":t.none(),
        "Exp":t.none(),
        "Exp'":t.none()
        },
    21:{
        "Arg":t.none(),
        "Args":t.none(),
        "Atom":t.none(),
        "Call":t.none(),
        "Exp":t.none(),
        "Exp'":t.none()
        },
    22:{
        "Arg":t.none(),
        "Args":t.none(),
        "Atom":t.none(),
        "Call":t.none(),
        "Exp":t.none(),
        "Exp'":t.none()
        },
    23:{
        "Arg":t.none(),
        "Args":t.none(),
        "Atom":t.none(),
        "Call":t.none(),
        "Exp":t.none(),
        "Exp'":t.none()
        },
    24:{
        "Arg":t.none(),
        "Args":t.none(),
        "Atom":t.none(),
        "Call":t.none(),
        "Exp":t.none(),
        "Exp'":t.none()
        },
    25:{
        "Arg":t.none(),
        "Args":t.none(),
        "Atom":t.none(),
        "Call":t.none(),
        "Exp":t.none(),
        "Exp'":t.none()
        },
    26:{
        "Arg":t.none(),
        "Args":t.none(),
        "Atom":t.none(),
        "Call":t.none(),
        "Exp":t.none(),
        "Exp'":t.none()
        },
    27:{
        "Arg":t.none(),
        "Args":t.none(),
        "Atom":t.none(),
        "Call":t.none(),
        "Exp":t.none(),
        "Exp'":t.none()
        },
    28:{
        "Arg":t.some(23),
        "Args":t.some(30),
        "Atom":t.some(25),
        "Call":t.some(26),
        "Exp":t.none(),
        "Exp'":t.none()
        },
    29:{
        "Arg":t.none(),
        "Args":t.none(),
        "Atom":t.none(),
        "Call":t.none(),
        "Exp":t.none(),
        "Exp'":t.none()
        },
    30:{
        "Arg":t.none(),
        "Args":t.none(),
        "Atom":t.none(),
        "Call":t.none(),
        "Exp":t.none(),
        "Exp'":t.none()
        }
    };
var tokens = [
{name:"comma",cap:false,reg:","},
{name:"divide",cap:false,reg:"/"},
{name:"float",cap:true,reg:"[0-9]*.[0-9]+"},
{name:"id",cap:true,reg:"[a-zA-Z]+"},
{name:"int",cap:true,reg:"[0-9]+"},
{name:"lpar",cap:false,reg:"\\("},
{name:"minus",cap:false,reg:"-"},
{name:"plus",cap:false,reg:"\\+"},
{name:"power",cap:false,reg:"\\^"},
{name:"rpar",cap:false,reg:"\\)"},
{name:"times",cap:false,reg:"\\*"}
]

var lexer = function(inStr){ 
    var rxStr =
        "(,)|"+
        "(\\/)|"+
        "([0-9]*\\.[0-9]+)|"+
        "([a-zA-Z]+)|"+
        "([0-9]+)|"+
        "(\\()|"+
        "(-)|"+
        "(\\+)|"+
        "(\\^)|"+
        "(\\))|"+
        "(\\*)|"+
        "\n|"+
        "\r|"+
        "\t|"+
        " ";
    var rx = new RegExp(rxStr,"g");
    var retI = 0;
    var retval = {};
    var resStr = inStr.replace(rx,
        function(a,i1,i2,i3,i4,i5,i6,i7,i8,i9,i10,i11){
            if(typeof i1 !== "undefined"){
                retval[retI] = {t:"none",v:i1,tv:"comma"};
                retI++;
                }
            else if(typeof i2 !== "undefined"){
                retval[retI] = {t:"none",v:i2,tv:"divide"};
                retI++;
                }
            else if(typeof i3 !== "undefined"){
                retval[retI] = {t:"some",v:i3,tv:"float"};
                retI++;
                }
            else if(typeof i4 !== "undefined"){
                retval[retI] = {t:"some",v:i1,tv:"id"};
                retI++;
                }
            else if(typeof i5 !== "undefined"){
                retval[retI] = {t:"some",v:i5,tv:"int"};
                retI++;
                }
            else if(typeof i6 !== "undefined"){
                retval[retI] = {t:"none",v:null,tv:"lpar"};
                retI++;
                }
            else if(typeof i7 !== "undefined"){
                retval[retI] = {t:"none",v:null,tv:"minus"};
                retI++;
                }
            else if(typeof i8 !== "undefined"){
                retval[retI] = {t:"none",v:i8,tv:"plus"};
                retI++;
                }
            else if(typeof i9 !== "undefined"){
                retval[retI] = {t:"none",v:i9,tv:"power"};
                retI++;
                }
            else if(typeof i10 !== "undefined"){
                retval[retI] = {t:"none",v:i10,tv:"rpar"};
                retI++;
                }
            else if(typeof i11 !== "undefined"){
                retval[retI] = {t:"none",v:i11,tv:"times"};
                retI++;
                }
            return "";
            }
        );
    if(resStr !== ""){
        //alert("error : " + resStr);
        return "error";
        }
    retval[retI] = {t:"none",v:null,tv:"$"};
    return retval;
    };
var parser = function(tokens){
    var sStack = new Stack();
    var tree = new Stack();
    var i = 0;
    var parsing = true;
    sStack.push(0);
    while(parsing){
        var s = sStack.peek();
        //check for undefined
        var a = tokens[i].tv;
        var entry = actionTable[s][a];
        switch(entry.type){
            case "shift":
                sStack.push(entry.v);
                tree = addToken2tree(tree,tokens[i]);
                i += 1;
                break;
            case "reduce":
                var r = entry.v;
                var prod = productions_str[r];
                var rSide = prod.rside;
                var pName = prod.prod;
                var pFun = productions_fun[r];
                sStack.popN(rSide.length,function(x){});
                sStack.push(gotoTable[sStack.peek()][pName].v);
                tree = pFun(tree);
                //printfn("r = " + r + ", peek = " + sStack.peek());
                //printfn(pName + " -> " + rSide);
                //printfn("stack-peek = " + sStack.peek());
                break;
            case "accept":
                //alert("done");
                return tree;
            case "error":
                //var msg = entry.v;
                //alert("syntax error: " + msg);
                //return "syntax error: " + msg;
                //alert("syntax error")
                //return "syntax error";
                alert("syntax error");
                return tree;
            }
        }
    };



var a1 = "1 * (2 + 3) ^ 4 - 5 / 6 * pow(2,4)";
var a1_lexed = lexer(a1);
var a1_parsed = parser(a1_lexed);
printfn(a1_parsed.peek().nval)
/*
var i0 = 0;
var h0 = a1_lexed[i0];
while(h0 !== undefined){
    printfn(h0o.tv);
    i0++;
    h0 = a1_lexed[i0]
    }
*/      
        </script>
    </body>
</html>
